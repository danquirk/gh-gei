using System.Threading.Tasks;using FluentAssertions;using Newtonsoft.Json.Linq;using OctoshiftCLI.Models;using OctoshiftCLI.Services;using Xunit;namespace OctoshiftCLI.Tests;public class AdoBranchPolicyServiceDefaultBranchTests{class TestAdoApi:AdoApi{public string CapturedRef;public TestAdoApi():base(new AdoClient(new OctoLogger(),null,null,new RetryPolicy(new OctoLogger()),"pat"),"https://dev.azure.com",new OctoLogger()){}public override Task<string> GetRepoId(string org,string teamProject,string repo)=>Task.FromResult("id");public override Task<string> GetRepoDefaultBranch(string org,string teamProject,string repo)=>Task.FromResult("refs/heads/develop");public override Task<JArray> GetBranchPolicyConfigurations(string org,string teamProject,string repoId,string refName){CapturedRef=refName;return Task.FromResult(new JArray());}}[Fact]public async Task Uses_DefaultBranch_From_Ado(){var api=new TestAdoApi();var svc=new AdoBranchPolicyService(api);var policies=await svc.GetDefaultBranchPolicies("o","p","r");policies.Should().BeEmpty();api.CapturedRef.Should().Be("refs/heads/develop");}}