using System.Collections.Generic;using System.Linq;using OctoshiftCLI.Models;namespace OctoshiftCLI.Services;public class DefaultBranchPolicyExtractionService{public GithubRulesetDefinition BuildRuleset(string defaultBranch,string rulesetName,IEnumerable<AdoPolicyConfiguration> policies){var enabled=policies.Where(p=>p.Enabled).ToList();var requiresWorkItem=enabled.Any(p=>p.Type==AdoPolicyType.WorkItemLinking);var requiresCommentResolution=enabled.Any(p=>p.Type==AdoPolicyType.CommentResolution);if(requiresWorkItem||requiresCommentResolution){throw new OctoshiftCliException("Cannot migrate policies: WorkItemLinking or CommentResolution not yet supported in rulesets");}int? reviewers=enabled.Where(p=>p.Type==AdoPolicyType.MinimumReviewers).Select(p=>p.MinimumApproverCount).Where(c=>c.HasValue).DefaultIfEmpty().Max();var status=enabled.Where(p=>p.Type==AdoPolicyType.BuildValidation).Select(p=>p.StatusCheckContext).Where(s=>!string.IsNullOrWhiteSpace(s)).Distinct().ToArray();return new GithubRulesetDefinition{Name=rulesetName,TargetPatterns=new[]{defaultBranch},RequiredApprovingReviewCount=reviewers,RequiredStatusChecks=status};}}